/**
 * Helper script for enhanced tag input
 *
 * @package WPametu
 * @author Takahashi Fumiki
 *
 *//*global WPametuEnhancedTags: true*/jQuery(document).ready(function(e){var t=function(t){return e(t).parents(".tagsdiv").attr("id")},n=function(e){return WPametuEnhancedTags.endpoint+"?action="+WPametuEnhancedTags.action+"&taxonomy="+e+"&"+WPametuEnhancedTags.nonceKey+"="+WPametuEnhancedTags.nonceValue},r=function(t,n){var r=e(n).tokenInput("get"),i=[];e.each(r,function(e,t){i.indexOf(t.name)&&i.push(t.name)});e(t).find("textarea.the-tags").val(i.join(","))},i=function(t,n,r){var i=e(t).tokenInput("get"),s=!0;e.each(i,function(e,t){if(t.name===n){s=!1;return!1}});s&&e(t).tokenInput("add",{id:r,name:n})};e(".jaxtag").each(function(s,o){var u=e('<input type="hidden" class="wpametu-newtag" id="newtag-'+t(o)+'" value="" />'),a=t(o),f="#token-input-newtag-"+a,l="",c=0,h={theme:"facebook",preventDuplicates:!0,tokenValue:"name",hintText:WPametuEnhancedTags.hintText,noResultsText:WPametuEnhancedTags.noResultsText,searchingText:WPametuEnhancedTags.searchingText,resultsFormatter:function(e){var t=e.name;e.count>=0&&(t+="<small> ("+e.count+")</small>");return"<li>"+t+"</li>"},onReady:function(){e(f).keyup(function(){l=this.value})},onAdd:function(t){if(!t.id){c++;e(u).tokenInput("remove",{id:0});i(u,l,c*-1)}r(o,u)},onDelete:function(){r(o,u)}};e.ajax({type:"GET",url:n(a),data:{type:WPametuEnhancedTags.searchType,terms:e(o).find("textarea.the-tags").val()},dataType:"json",success:function(e){e.length&&(h.prePopulate=e);u.insertBefore(o);u.tokenInput(n(a),h)}});var p="#tagcloud-"+a,d=setInterval(function(){if(e(p).length){clearInterval(d);e(p).find("a").click(function(){var t=parseInt(e(this).attr("class").replace(/^[^0-9]+/,""),10),n=e.trim(e(this).text());i(u,n,t);r(o,u)})}},1e3)})});